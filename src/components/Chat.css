.chat {
    flex: 0.70;
    /* Desktop takes remaining space */
    display: flex;
    flex-direction: column;
    height: 100%;
    background-color: var(--bg-default);
    position: relative;
    /* Background Image is set dynamically/inline mainly, but fallback here */
    background-image: url("https://user-images.githubusercontent.com/15075759/28719144-86dc0f70-73b1-11e7-911d-60d70fcded21.png");
    background-repeat: repeat;
}

.chat-header {
    height: 59px;
    /* Match sidebar header */
    padding: 0 16px;
    display: flex;
    align-items: center;
    border-bottom: 1px solid var(--border-color);
    background-color: var(--header-bg);
    z-index: 10;
    box-shadow: none;
    /* Modern look usually has just border or minimal shadow */
}

.chat-header .MuiAvatar-root {
    width: 40px !important;
    /* Header avatar is usually slightly smaller than list, or same. Let's keep 40px for header or 45px? 40px is standard header. */
    height: 40px !important;
    cursor: pointer;
}

.chat-header-info {
    flex: 1;
    padding-left: 15px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    cursor: pointer;
}

.chat-header-info h3 {
    margin: 0;
    font-weight: 500;
    font-size: 16px;
    color: var(--text-primary);
    /* Multi-line clamp */
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
    white-space: normal;
    line-height: 1.2;
}

.chat-header-info p {
    margin: 2px 0 0;
    color: var(--text-secondary);
    font-size: 13px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.header-actions {
    display: flex;
    align-items: center;
    justify-content: flex-end;
    gap: 15px;
}

.header-actions .MuiSvgIcon-root {
    color: var(--text-secondary);
    font-size: 24px;
    cursor: pointer;
}

/* Chat Body */
.chat-body {
    flex: 1;
    background-repeat: repeat;
    background-size: 400px;
    overflow-y: auto;
    /* Changed scroll to auto */
    padding: 20px 60px;
    /* Wider padding on desktop */
    padding-bottom: 20px;
}

/* Date Separator */
.chat-date-separator {
    display: flex;
    justify-content: center;
    margin: 10px 0;
    position: relative;
    z-index: 5;
}

.chat-date-separator span {
    background-color: rgba(255, 255, 255, 0.95);
    padding: 6px 12px;
    border-radius: 8px;
    font-size: 12.5px;
    color: #54656f;
    box-shadow: 0 1px 1px rgba(0, 0, 0, 0.1);
    text-transform: uppercase;
    /* Optional preference */
}

/* Message Styles */
.message {
    position: relative;
    font-size: 14.2px;
    /* Slightly smaller, more standard */
    padding: 6px 7px 8px 9px;
    width: fit-content;
    border-radius: 8px;
    /* Slightly squarer corners like WA */
    background-color: var(--incoming-msg);
    margin-bottom: 2px;
    /* Clustered nicely */
    margin-top: 2px;
    max-width: 65%;
    box-shadow: 0 1px 0.5px rgba(0, 0, 0, 0.13);
    word-wrap: break-word;
    color: var(--text-primary);
    line-height: 19px;
}

.chat__receiver {
    margin-left: auto;
    background-color: var(--outgoing-msg);
}

/* Tails */
/* Only add tails to first/last or use pseudo for specific look. 
   Simplifying tails for cleaner CSS to match modern WA Web which sometimes omits them or keeps them minimal.
   We will keep current tail implementation but updated colors. */

.message:not(.chat__receiver)::before {
    border-right-color: var(--incoming-msg);
    /* Rest same as previous if needed, or remove for simpler bubble look */
}

.chat__receiver::before {
    border-left-color: var(--outgoing-msg);
}

.message-name {
    top: -15px;
    /* Adjust if needed */
    font-size: 12px;
    color: var(--secondary-green);
    /* Or colors for group members */
}

.timestamp {
    font-size: 11px;
    color: var(--text-secondary);
    float: right;
    margin-top: 5px;
    margin-left: 20px;
    /* Space from text */
    margin-right: -4px;
    /* Align slightly right */
    margin-bottom: -5px;
    display: flex;
    align-items: center;
}

/* Footer */
.chat-footer-container {
    background-color: var(--bg-panel);
    /* Matches header? usually footer is lighter/white or same as header */
    width: 100%;
    z-index: 20;
}

.chat-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    height: 62px;
    padding: 5px 10px;
    background-color: var(--header-bg);
    border-top: 1px solid var(--border-color);
}

.chat-footer form {
    flex: 1;
    display: flex;
    margin: 0 10px;
}

.chat-footer form input {
    flex: 1;
    border-radius: 8px;
    padding: 9px 12px;
    border: 1px solid transparent;
    /* or none */
    outline: none;
    font-size: 15px;
    background-color: white;
    /* Input always white usually */
}

[data-theme='dark'] .chat-footer form input {
    background-color: #2a3942;
    color: white;
}

.chat-footer .MuiSvgIcon-root {
    color: var(--text-secondary);
    padding: 5px;
    cursor: pointer;
}


/* Message Actions / Reactions Button Container */
.reaction-btn-container {
    position: absolute;
    top: -24px;
    right: 0;
    display: flex;
    gap: 2px;
    background-color: var(--bg-panel);
    border-radius: 12px;
    padding: 0 4px;
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.15);
    opacity: 0;
    transition: opacity 0.2s ease;
    z-index: 10;
}

[data-theme='dark'] .reaction-btn-container {
    background-color: var(--sidebar-header);
}

.message:hover .reaction-btn-container {
    opacity: 1;
}

.reaction-btn-container.sender {
    right: 0;
    /* Aligned right for sender */
}

.reaction-btn-container.receiver {
    right: 0;
    /* Keep it right aligned or move to right of bubble? Usually top-right of bubble is standard or floated right outside. */
    right: -50px;
    /* Let's try inside or just outside? Inside is cleaner if top-right. */
    /* Screenshot showed them sort of inside or near. Let's put them Top Right of bubble always. */
    right: 0;
    top: -28px;
    /* Slightly higher if receiver name exists? */
    /* Let's stick to standard top-right overlapping or just above */
}

.reaction-trigger-btn {
    padding: 2px !important;
    color: var(--icon-color) !important;
}

.reaction-trigger-btn:hover {
    background-color: rgba(0, 0, 0, 0.05) !important;
}

/* Reaction Picker Popover */
.reaction-picker {
    position: absolute;
    top: -45px;
    right: 0;
    background-color: var(--bg-panel);
    border-radius: 20px;
    padding: 5px 10px;
    display: flex;
    gap: 5px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
    z-index: 20;
    white-space: nowrap;
}

.reaction-option {
    cursor: pointer;
    font-size: 18px;
    transition: transform 0.2s;
}

.reaction-option:hover {
    transform: scale(1.2);
}

.message-meta-row {
    display: flex;
    justify-content: flex-end;
    align-items: center;
    flex-wrap: wrap;
    gap: 5px;
    margin-top: 2px;
}

.message-reactions {
    display: flex;
    gap: 2px;
    margin-right: auto;
    /* Push timestamp to right */
}

.reaction-pill {
    background-color: rgba(0, 0, 0, 0.05);
    border-radius: 10px;
    padding: 2px 6px;
    font-size: 11px;
    display: inline-flex;
    align-items: center;
}

[data-theme='dark'] .reaction-pill {
    background-color: rgba(255, 255, 255, 0.1);
}

/* --- Mobile Tweaks --- */
@media (max-width: 900px) {
    .chat-body {
        padding: 15px 12px;
    }

    .message {
        max-width: 88%;
        font-size: 14px;
    }

    .chat-header {
        padding: 0 8px;
    }

    .chat-back-button {
        display: block !important;
        margin-right: 2px;
    }

    .chat-header-info {
        padding-left: 10px;
    }

    /* Hide some desktop actions on mobile if crowded */
    .header-actions {
        gap: 15px;
        /* Increase gap slightly for touch */
    }

    .header-actions .MuiSvgIcon-root {
        font-size: 28px !important;
        /* Larger for mobile */
        padding: 5px;
    }

    /* Floating input bar look on mobile */
    .chat-footer {
        padding: 5px 8px 5px 5px;
        background-color: var(--header-bg);
    }

    .chat-footer form {
        margin: 0 5px;
    }

    .chat-footer form input {
        border-radius: 20px;
        /* Pill shape */
        padding: 10px 15px;
        font-size: 15px;
    }

    /* Animation for chat slide in */
    .chat {
        animation: slideInRight 0.25s cubic-bezier(0.1, 0.82, 0.25, 1) forwards;
    }

    @keyframes slideInRight {
        from {
            transform: translateX(100%);
            opacity: 0.5;
        }

        to {
            transform: translateX(0);
            opacity: 1;
        }
    }

    /* Fix oversized images on mobile */
    .message img {
        max-width: 100% !important;
        height: auto !important;
        max-height: 300px !important;
        /* Cap height to avoid taking full screen */
        object-fit: cover;
        border-radius: 8px;
    }
}